<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Ordering Homepage</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B00',
                        secondary: '#1E293B',
                        accent: '#F59E0B',
                    },
                    animation: {
                        fadeIn: 'fadeIn 0.5s ease-in-out',
                        slideIn: 'slideIn 0.3s ease-in-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateY(-10px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                    },
                },
            },
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 font-['Inter'] min-h-screen flex flex-col">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <img src="https://via.placeholder.com/50" alt="Logo" class="h-10 mr-3 rounded-full">
                <span class="text-xl font-bold text-primary">FoodOrder</span>
            </div>
            <div class="hidden md:flex space-x-6">
                <a href="#" class="text-secondary hover:text-primary font-medium transition-colors duration-300">Home</a>
                <a href="#" class="text-secondary hover:text-primary font-medium transition-colors duration-300">Categories</a>
                <a href="#" class="text-secondary hover:text-primary font-medium transition-colors duration-300">Merchants</a>
                <a href="#" class="text-secondary hover:text-primary font-medium transition-colors duration-300">Contact</a>
            </div>
            <div class="md:hidden">
                <button id="menu-toggle" class="focus:outline-none">
                    <i class="fas fa-bars text-secondary text-xl"></i>
                </button>
            </div>
        </div>
        <div id="mobile-menu" class="hidden bg-white shadow-md px-4 sm:px-6 py-6 md:hidden animate-slideIn">
            <a href="#" class="block py-2 text-secondary hover:text-primary font-medium transition-colors duration-300">Home</a>
            <a href="#" class="block py-2 text-secondary hover:text-primary font-medium transition-colors duration-300">Categories</a>
            <a href="#" class="block py-2 text-secondary hover:text-primary font-medium transition-colors duration-300">Merchants</a>
            <a href="#" class="block py-2 text-secondary hover:text-primary font-medium transition-colors duration-300">Contact</a>
        </div>
    </nav>

    <!-- Search Bar -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="relative max-w-md mx-auto">
            <input type="text" id="search-bar" placeholder="Search for delicious food..." class="w-full p-3 rounded-full border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary shadow-sm placeholder-gray-400 transition-shadow duration-300 hover:shadow-md text-sm">
            <i class="fas fa-search absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
    </div>

    <!-- Image Slider (Auto-Swipe) -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div id="slider-container" class="relative overflow-hidden rounded-xl shadow-lg max-w-4xl mx-auto">
            <div id="slider" class="flex transition-transform duration-700 ease-in-out">
                <img src="https://via.placeholder.com/1200x300?text=Food+Banner+1" alt="Banner 1" class="w-full h-[200px] sm:h-[250px] lg:h-[300px] object-cover flex-shrink-0">
                <img src="https://via.placeholder.com/1200x300?text=Food+Banner+2" alt="Banner 2" class="w-full h-[200px] sm:h-[250px] lg:h-[300px] object-cover flex-shrink-0">
                <img src="https://via.placeholder.com/1200x300?text=Food+Banner+3" alt="Banner 3" class="w-full h-[200px] sm:h-[250px] lg:h-[300px] object-cover flex-shrink-0">
            </div>
            <button id="prev-slide" class="absolute left-0 top-1/2 transform -translate-y-1/2 bg-primary text-white p-2 rounded-r-full hover:bg-accent focus:outline-none opacity-80 hover:opacity-100 transition-opacity duration-300">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="next-slide" class="absolute right-0 top-1/2 transform -translate-y-1/2 bg-primary text-white p-2 rounded-l-full hover:bg-accent focus:outline-none opacity-80 hover:opacity-100 transition-opacity duration-300">
                <i class="fas fa-chevron-right"></i>
            </button>
            <div class="absolute bottom-3 left-1/2 transform -translate-x-1/2 flex space-x-2">
                <div class="w-3 h-3 bg-primary rounded-full cursor-pointer slide-dot scale-110" data-index="0"></div>
                <div class="w-3 h-3 bg-gray-300 rounded-full cursor-pointer slide-dot" data-index="1"></div>
                <div class="w-3 h-3 bg-gray-300 rounded-full cursor-pointer slide-dot" data-index="2"></div>
            </div>
        </div>
    </div>

    <!-- Product Grid -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10 animate-fadeIn">
        <h2 class="text-3xl font-bold text-secondary mb-6 text-center tracking-tight">Explore Our Menu</h2>
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div id="loading" class="col-span-full text-center text-gray-500 hidden">Loading products...</div>
        </div>
    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-2xl max-w-md w-full shadow-xl transform scale-95 transition-transform duration-300">
            <h3 id="modal-title" class="text-xl font-bold text-secondary mb-3"></h3>
            <img id="modal-image" src="" alt="Product" class="w-full h-48 object-cover rounded-lg mb-3">
            <p id="modal-description" class="text-gray-600 text-sm mb-3"></p>
            <p id="modal-price" class="text-lg font-semibold text-primary mb-3"></p>
            <p id="modal-merchant" class="text-gray-600 text-sm mb-2"></p>
            <p id="modal-address" class="text-gray-600 text-sm mb-4"></p>
            <div class="flex justify-end space-x-3">
                <button id="order-btn" class="bg-primary text-white px-5 py-2 rounded-full hover:bg-accent focus:outline-none transition-colors duration-300 text-sm">Order Now</button>
                <button id="close-modal" class="text-secondary hover:text-primary font-medium text-sm transition-colors duration-300">Close</button>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden z-50">
        <div class="bg-white p-6 rounded-2xl max-w-md w-full shadow-xl transform scale-95 transition-transform duration-300">
            <h3 class="text-xl font-bold text-secondary mb-4">Complete Your Order</h3>
            <form id="checkout-form" class="space-y-4">
                <div>
                    <label for="full-name" class="block text-gray-700 font-medium text-sm mb-1">Full Name</label>
                    <input type="text" id="full-name" class="w-full p-3 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary transition-shadow duration-300 hover:shadow-md text-sm" required>
                </div>
                <div>
                    <label for="address" class="block text-gray-700 font-medium text-sm mb-1">Address (RT/RW)</label>
                    <input type="text" id="address" class="w-full p-3 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary transition-shadow duration-300 hover:shadow-md text-sm" required>
                </div>
                <div>
                    <label for="phone" class="block text-gray-700 font-medium text-sm mb-1">Phone Number</label>
                    <input type="tel" id="phone" class="w-full p-3 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-primary transition-shadow duration-300 hover:shadow-md text-sm" required>
                </div>
                <input type="hidden" id="product-id" name="product-id">
                <div class="flex justify-end space-x-3">
                    <button type="submit" class="bg-primary text-white px-5 py-2 rounded-full hover:bg-accent focus:outline-none transition-colors duration-300 text-sm">Confirm Order</button>
                    <button id="close-checkout" type="button" class="text-secondary hover:text-primary font-medium text-sm transition-colors duration-300">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-secondary text-white py-10 mt-auto">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-3">FoodOrder</h3>
                    <p class="text-gray-300 text-sm">Delivering delicious meals from your favorite local merchants, right to your door.</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-3">Quick Links</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">Home</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">Categories</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">Merchants</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">Contact</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-3">Contact Us</h3>
                    <p class="text-gray-300 text-sm">Email: support@foodorder.com</p>
                    <p class="text-gray-300 text-sm">Phone: +62 123 456 7890</p>
                    <p class="text-gray-300 text-sm">Address: Jl. Makanan No. 123, Jakarta</p>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-3">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">
                            <i class="fab fa-x-twitter text-lg"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">
                            <i class="fab fa-instagram text-lg"></i>
                        </a>
                        <a href="#" class="text-gray-300 hover:text-accent transition-colors duration-300">
                            <i class="fab fa-facebook-f text-lg"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="mt-8 border-t border-gray-700 pt-6 text-center text-gray-300 text-sm">
                <p>&copy; 2025 FoodOrder. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Initialize Supabase client
        const supabase = supabase.createClient('YOUR_SUPABASE_URL', 'YOUR_SUPABASE_KEY');

        // Fetch WhatsApp numbers from Supabase
        async function fetchWhatsAppNumbers() {
            const { data, error } = await supabase.from('message').select('whatsapp_number').eq('is_active', true);
            if (error) {
                console.error('Error fetching WhatsApp numbers:', error);
                return ['+6281234567890', '+6281234567891', '+6281234567892', '+6281234567893'];
            }
            return data.map(item => item.whatsapp_number);
        }

        // Fetch products from Supabase
        async function fetchProducts(searchTerm = '') {
            const loading = document.getElementById('loading');
            loading.classList.remove('hidden');
            let query = supabase.from('products').select('*');
            if (searchTerm) {
                query = query.or(`name.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%,merchant_name.ilike.%${searchTerm}%,category.ilike.%${searchTerm}%`);
            }
            const { data, error } = await query;
            loading.classList.add('hidden');
            if (error) {
                console.error('Error fetching products:', error);
                document.getElementById('product-grid').innerHTML = '<p class="col-span-full text-center text-gray-500 text-sm">Failed to load products.</p>';
                return;
            }
            renderProducts(data);
        }

        // Render product cards
        function renderProducts(products) {
            const productGrid = document.getElementById('product-grid');
            productGrid.innerHTML = '';
            if (products.length === 0) {
                productGrid.innerHTML = '<p class="col-span-full text-center text-gray-500 text-sm">No products found.</p>';
                return;
            }
            products.forEach(product => {
                const card = document.createElement('div');
                card.className = 'bg-white p-5 rounded-xl shadow-md hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1';
                card.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover rounded-lg mb-3">
                    <h3 class="text-lg font-semibold text-secondary">${product.name}</h3>
                    <p class="text-gray-600 mt-1 text-sm line-clamp-2">${product.description}</p>
                    <p class="text-primary font-bold text-base mt-2">Rp ${product.price}</p>
                    <p class="text-gray-500 mt-1 text-sm">${product.merchant_name}</p>
                    <p class="text-gray-500 mt-1 text-sm truncate">${product.merchant_address}</p>
                    <button class="mt-3 bg-primary text-white px-5 py-2 rounded-full hover:bg-accent w-full focus:outline-none transition-colors duration-300 text-sm" onclick="openProductModal(${product.id})">View Details</button>
                `;
                productGrid.appendChild(card);
            });
        }

        // Open product modal
        async function openProductModal(productId) {
            const { data, error } = await supabase.from('products').select('*').eq('id', productId).single();
            if (error) {
                console.error('Error fetching product:', error);
                alert('Failed to load product details.');
                return;
            }
            document.getElementById('modal-title').textContent = data.name;
            document.getElementById('modal-image').src = data.image;
            document.getElementById('modal-description').textContent = data.description;
            document.getElementById('modal-price').textContent = `Rp ${data.price}`;
            document.getElementById('modal-merchant').textContent = `Merchant: ${data.merchant_name}`;
            document.getElementById('modal-address').textContent = `Address: ${data.merchant_address}`;
            document.getElementById('product-id').value = data.id;
            document.getElementById('product-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('product-modal').querySelector('div').classList.add('scale-100'), 10);
        }

        // Open checkout modal
        document.getElementById('order-btn').addEventListener('click', () => {
            document.getElementById('product-modal').classList.add('hidden');
            document.getElementById('checkout-modal').classList.remove('hidden');
            setTimeout(() => document.getElementById('checkout-modal').querySelector('div').classList.add('scale-100'), 10);
        });

        // Close modals
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('product-modal').classList.add('hidden');
            document.getElementById('product-modal').querySelector('div').classList.remove('scale-100');
        });
        document.getElementById('close-checkout').addEventListener('click', () => {
            document.getElementById('checkout-modal').classList.add('hidden');
            document.getElementById('checkout-modal').querySelector('div').classList.remove('scale-100');
        });

        // Handle checkout form submission
        let whatsappNumbers = [];
        let currentOperatorIndex = 0;
        document.getElementById('checkout-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const fullName = document.getElementById('full-name').value;
            const address = document.getElementById('address').value;
            const phone = document.getElementById('phone').value;
            const productId = document.getElementById('product-id').value;

            if (!fullName || !address || !phone) {
                alert('Please fill in all fields.');
                return;
            }

            const { data: product, error } = await supabase.from('products').select('*').eq('id', productId).single();
            if (error) {
                console.error('Error fetching product for checkout:', error);
                alert('Failed to retrieve product details.');
                return;
            }

            const operatorNumber = whatsappNumbers[currentOperatorIndex] || whatsappNumbers[0];
            currentOperatorIndex = (currentOperatorIndex + 1) % whatsappNumbers.length;

            const message = `New Order:\nName: ${fullName}\nAddress: ${address}\nPhone: ${phone}\nMerchant: ${product.merchant_name}\nProduct: ${product.name}\nPrice: Rp ${product.price}`;
            const whatsappUrl = `https://wa.me/${operatorNumber}?text=${encodeURIComponent(message)}`;

            window.location.href = whatsappUrl;

            document.getElementById('checkout-form').reset();
            document.getElementById('checkout-modal').classList.add('hidden');
            document.getElementById('checkout-modal').querySelector('div').classList.remove('scale-100');
        });

        // Auto-Swipe Slider with Touch Support
        let currentSlide = 0;
        let touchStartX = 0;
        let touchEndX = 0;
        const slides = document.querySelectorAll('#slider img');
        const dots = document.querySelectorAll('.slide-dot');
        const slider = document.getElementById('slider');
        let autoSlideInterval = null;

        function showSlide(index) {
            if (slides.length === 0) return;
            if (index >= slides.length) index = 0;
            if (index < 0) index = slides.length - 1;
            currentSlide = index;
            slider.style.transform = `translateX(-${currentSlide * 100}%)`;
            dots.forEach((dot, i) => {
                dot.classList.toggle('bg-primary', i === currentSlide);
                dot.classList.toggle('bg-gray-300', i !== currentSlide);
                dot.classList.toggle('scale-110', i === currentSlide);
            });
        }

        function startAutoSlide() {
            if (autoSlideInterval) clearInterval(autoSlideInterval);
            autoSlideInterval = setInterval(() => {
                showSlide(currentSlide + 1);
            }, 4000);
        }

        function stopAutoSlide() {
            if (autoSlideInterval) clearInterval(autoSlideInterval);
        }

        document.getElementById('next-slide').addEventListener('click', () => {
            stopAutoSlide();
            showSlide(currentSlide + 1);
            startAutoSlide();
        });

        document.getElementById('prev-slide').addEventListener('click', () => {
            stopAutoSlide();
            showSlide(currentSlide - 1);
            startAutoSlide();
        });

        dots.forEach(dot => {
            dot.addEventListener('click', () => {
                stopAutoSlide();
                showSlide(parseInt(dot.getAttribute('data-index')));
                startAutoSlide();
            });
        });

        // Touch support for mobile
        const sliderContainer = document.getElementById('slider-container');
        sliderContainer.addEventListener('touchstart', (e) => {
            stopAutoSlide();
            touchStartX = e.touches[0].clientX;
        });

        sliderContainer.addEventListener('touchmove', (e) => {
            touchEndX = e.touches[0].clientX;
        });

        sliderContainer.addEventListener('touchend', () => {
            const deltaX = touchStartX - touchEndX;
            if (Math.abs(deltaX) > 50) {
                stopAutoSlide();
                if (deltaX > 0) {
                    showSlide(currentSlide + 1);
                } else {
                    showSlide(currentSlide - 1);
                }
                startAutoSlide();
            }
            touchStartX = 0;
            touchEndX = 0;
        });

        sliderContainer.addEventListener('mouseenter', stopAutoSlide);
        sliderContainer.addEventListener('mouseleave', startAutoSlide);

        // Mobile menu toggle
        document.getElementById('menu-toggle').addEventListener('click', () => {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });

        // Debounced search
        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        document.getElementById('search-bar').addEventListener('input', debounce(async (e) => {
            const searchTerm = e.target.value.trim();
            await fetchProducts(searchTerm);
        }, 300));

        // Initialize
        async function initialize() {
            whatsappNumbers = await fetchWhatsAppNumbers();
            if (whatsappNumbers.length === 0) {
                console.error('No active WhatsApp numbers found, using fallback');
                whatsappNumbers = ['+6281234567890', '+6281234567891', '+6281234567892', '+6281234567893'];
            }
            await fetchProducts();
            if (slides.length > 0) {
                showSlide(currentSlide);
                startAutoSlide();
            }
        }

        // Run initialization on DOM content loaded
        document.addEventListener('DOMContentLoaded', initialize);
    </script>

    <style>
        @media (max-width: 640px) {
            #slider img {
                height: 200px;
            }
            #product-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding-left: 12px;
                padding-right: 12px;
            }
            .text-3xl {
                font-size: 1.75rem;
            }
        }
        @media (min-width: 641px) and (max-width: 1024px) {
            #slider img {
                height: 250px;
            }
            #product-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        @media (min-width: 1025px) {
            #slider img {
                height: 300px;
            }
            #product-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</body>
</html>
