<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Pemesanan Makanan - FoodieHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-indigo-100 to-blue-200 min-h-screen font-inter transition-colors duration-500 dark:bg-gradient-to-br dark:from-gray-900 dark:to-gray-800" id="body">
    <!-- Header -->
    <header class="w-full bg-white dark:bg-gray-900 shadow-xl p-4 sticky top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="https://via.placeholder.com/40?text=FH" alt="Logo FoodieHub" class="h-10 rounded-full shadow-md">
                <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-indigo-600 dark:text-indigo-300">FoodieHub</h1>
            </div>
            <div class="flex items-center space-x-2 sm:space-x-4">
                <div class="relative w-40 sm:w-48 md:w-64">
                    <input type="text" id="search-input" placeholder="Cari makanan..." class="w-full px-4 py-2 border border-indigo-200 dark:border-gray-600 rounded-full focus:ring-2 focus:ring-indigo-500 dark:bg-gray-800 dark:text-white transition-all duration-300 shadow-sm text-sm sm:text-base" aria-label="Cari makanan">
                    <i class="fas fa-search absolute right-3 top-3 text-indigo-400 dark:text-gray-400"></i>
                </div>
                <button id="theme-toggle" class="p-2 rounded-full bg-indigo-100 dark:bg-gray-700 text-indigo-600 dark:text-indigo-300 hover:bg-indigo-200 dark:hover:bg-gray-600 transition-all duration-300 shadow-sm" aria-label="Toggle tema">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="sidebar-toggle" class="p-2 text-gray-700 dark:text-gray-300 hover:text-indigo-500 transition-all duration-300 lg:hidden" aria-label="Buka sidebar">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-900 shadow-2xl transform -translate-x-full lg:translate-x-0 transition-transform duration-500 z-40 lg:sticky lg:top-16">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-indigo-600 dark:text-indigo-300">Navigasi</h2>
                <button id="sidebar-close" class="p-2 text-gray-700 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300 lg:hidden" aria-label="Tutup sidebar">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <nav class="space-y-4">
                <a href="/index.html" class="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300 text-base">
                    <i class="fas fa-home"></i>
                    <span>Beranda</span>
                </a>
                <a href="/menu.html" class="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300 text-base">
                    <i class="fas fa-utensils"></i>
                    <span>Menu</span>
                </a>
                <a href="/promo.html" class="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300 text-base">
                    <i class="fas fa-tags"></i>
                    <span>Promo</span>
                </a>
                <a href="/contact.html" class="flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300 text-base">
                    <i class="fas fa-envelope"></i>
                    <span>Kontak</span>
                </a>
            </nav>
        </div>
    </aside>

    <!-- Overlay untuk sidebar di mobile -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden lg:hidden transition-opacity duration-500"></div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 lg:ml-64 relative transition-all duration-500">
        <!-- Slider -->
        <div id="slider" class="relative w-full h-48 sm:h-64 lg:h-80 mb-8 overflow-hidden rounded-2xl shadow-xl">
            <div id="slider-container" class="flex transition-transform duration-500">
                <!-- Slide akan dirender di sini via JS -->
            </div>
            <button id="slider-prev" class="absolute left-4 top-1/2 transform -translate-y-1/2 p-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-all duration-300 shadow-md" aria-label="Slide sebelumnya">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button id="slider-next" class="absolute right-4 top-1/2 transform -translate-y-1/2 p-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-all duration-300 shadow-md" aria-label="Slide berikutnya">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div id="loading" class="absolute inset-0 flex items-center justify-center bg-white bg-opacity-70 dark:bg-gray-900 dark:bg-opacity-70 hidden rounded-xl">
            <i class="fas fa-spinner fa-spin text-5xl text-indigo-500"></i>
        </div>
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 lg:gap-8">
            <!-- Kartu produk akan dirender di sini via JS -->
        </div>
        <div id="no-results" class="text-center text-gray-500 dark:text-gray-400 mt-8 hidden text-sm sm:text-base">Tidak ada hasil yang ditemukan. Coba kata kunci lain!</div>
    </main>

    <!-- Modal Detail Produk -->
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden transition-opacity duration-500" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="bg-white dark:bg-gray-900 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-2xl max-w-sm sm:max-w-md lg:max-w-lg w-full transform scale-90 transition-all duration-500">
            <button class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-all duration-300" onclick="closeModal('product-modal')" aria-label="Tutup modal">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 id="modal-title" class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white mb-4"></h2>
            <img id="modal-image" class="w-full h-36 sm:h-40 lg:h-48 object-cover rounded-xl mb-4 shadow-md" src="" alt="" loading="lazy">
            <p id="modal-description" class="text-gray-600 dark:text-gray-300 mb-4 text-xs sm:text-sm lg:text-base"></p>
            <p id="modal-price" class="text-lg sm:text-xl lg:text-2xl font-semibold text-green-600 mb-4"></p>
            <div class="flex items-center mb-4 sm:mb-6">
                <label for="quantity" class="text-gray-700 dark:text-gray-300 mr-4 text-xs sm:text-sm lg:text-base">Jumlah:</label>
                <input type="number" id="quantity" min="1" value="1" class="w-16 sm:w-20 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-indigo-500 transition-all duration-300 shadow-sm text-sm">
            </div>
            <p id="total-price" class="text-base sm:text-lg lg:text-xl font-semibold text-indigo-600 dark:text-indigo-400 mb-4 sm:mb-6"></p>
            <div class="flex justify-end space-x-2 sm:space-x-4">
                <button onclick="closeModal('product-modal')" class="px-4 sm:px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-300 shadow-md text-sm sm:text-base">Tutup</button>
                <button id="buy-button" class="px-4 sm:px-6 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-all duration-300 shadow-md text-sm sm:text-base">Beli Sekarang</button>
            </div>
        </div>
    </div>

    <!-- Modal Checkout -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden transition-opacity duration-500" role="dialog" aria-modal="true">
        <div class="bg-white dark:bg-gray-900 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-2xl max-w-sm sm:max-w-md lg:max-w-lg w-full transform scale-90 transition-all duration-500">
            <button class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-all duration-300" onclick="closeModal('checkout-modal')" aria-label="Tutup modal">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white mb-4 sm:mb-6">Checkout</h2>
            <form id="checkout-form">
                <div class="mb-4 sm:mb-5">
                    <label for="name" class="block text-gray-700 dark:text-gray-300 font-medium mb-2 text-xs sm:text-sm lg:text-base">Nama</label>
                    <input type="text" id="name" class="w-full px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 shadow-sm text-sm sm:text-base" required>
                </div>
                <div class="mb-4compare sm:mb-5">
                    <label for="address" class="block text-gray-700 dark:text-gray-300 font-medium mb-2 text-xs sm:text-sm lg:text-base">Alamat</label>
                    <input type="text" id="address" class="w-full px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 shadow-sm text-sm sm:text-base" required>
                </div>
                <div class="mb-4 sm:mb-6">
                    <label for="phone" class="block text-gray-700 dark:text-gray-300 font-medium mb-2 text-xs sm:text-sm lg:text-base">Nomor Telepon</label>
                    <input type="tel" id="phone" class="w-full px-4 py-2 sm:py-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-800 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 shadow-sm text-sm sm:text-base" required pattern="[0-9]{10,15}">
                </div>
                <p id="checkout-total" class="text-base sm:text-lg lg:text-xl font-semibold text-indigo-600 dark:text-indigo-400 mb-4 sm:mb-6"></p>
                <div class="flex justify-end space-x-2 sm:space-x-4">
                    <button type="button" onclick="closeModal('checkout-modal')" class="px-4 sm:px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 transition-all duration-300 shadow-md text-sm sm:text-base">Batal</button>
                    <button type="submit" class="px-4 sm:px-6 py-2 bg-green-600 text-white rounded-full hover:bg-green-700 transition-all duration-300 shadow-md text-sm sm:text-base">Selesaikan Pesanan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal COD Confirmation -->
    <div id="cod-modal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center hidden transition-opacity duration-500" role="dialog" aria-modal="true">
        <div class="bg-white dark:bg-gray-900 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-2xl max-w-sm sm:max-w-md lg:max-w-lg w-full transform scale-90 transition-all duration-500">
            <button class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 transition-all duration-300" onclick="closeModal('cod-modal')" aria-label="Tutup modal">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div class="flex items-center space-x-3 mb-4">
                <i class="fas fa-check-circle text-3xl sm:text-4xl text-green-500"></i>
                <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-800 dark:text-white">Konfirmasi COD</h2>
            </div>
            <p class="text-gray-600 dark:text-gray-300 mb-4 sm:mb-6 text-xs sm:text-sm lg:text-base">Pesanan Anda berhasil! Pembayaran akan dilakukan saat barang diterima (Cash on Delivery). Terima kasih!</p>
            <div class="flex justify-end">
                <button onclick="closeModal('cod-modal')" class="px-4 sm:px-6 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-all duration-300 shadow-md text-sm sm:text-base">Tutup</button>
            </div>
        </div>
    </div>

    <!-- Footer with Sitemap -->
    <footer class="w-full bg-white dark:bg-gray-900 shadow-xl p-6 sm:p-8 mt-auto transition-colors duration-300">
        <div class="max-w-7xl mx-auto grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 sm:gap-8 text-gray-600 dark:text-gray-400 text-xs sm:text-sm">
            <div>
                <h3 class="text-base sm:text-lg font-bold text-indigo-600 dark:text-indigo-300 mb-4">FoodieHub</h3>
                <p class="mb-4">Nikmati makanan favorit Anda dengan pengalaman pemesanan yang mudah dan cepat.</p>
                <div class="flex space-x-4">
                    <a href="https://facebook.com/foodiehub" target="_blank" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300" aria-label="Facebook"><i class="fab fa-facebook-f text-lg"></i></a>
                    <a href="https://instagram.com/foodiehub" target="_blank" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300" aria-label="Instagram"><i class="fab fa-instagram text-lg"></i></a>
                    <a href="https://twitter.com/foodiehub" target="_blank" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300" aria-label="Twitter"><i class="fab fa-twitter text-lg"></i></a>
                </div>
            </div>
            <div>
                <h3 class="text-base sm:text-lg font-bold text-indigo-600 dark:text-indigo-300 mb-4">Navigasi</h3>
                <ul class="space-y-2">
                    <li><a href="/index.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">Beranda</a></li>
                    <li><a href="/menu.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">Menu</a></li>
                    <li><a href="/promo.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">Promo</a></li>
                    <li><a href="/contact.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">Kontak</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-base sm:text-lg font-bold text-indigo-600 dark:text-indigo-300 mb-4">Bantuan</h3>
                <ul class="space-y-2">
                    <li><a href="/faq.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">FAQ</a></li>
                    <li><a href="/privacy.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">Kebijakan Privasi</a></li>
                    <li><a href="/terms.html" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">Syarat & Ketentuan</a></li>
                </ul>
            </div>
            <div>
                <h3 class="text-base sm:text-lg font-bold text-indigo-600 dark:text-indigo-300 mb-4">Kontak</h3>
                <ul class="space-y-2">
                    <li><a href="mailto:support@foodiehub.com" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">support@foodiehub.com</a></li>
                    <li><a href="tel:+6281234567890" class="hover:text-indigo-500 dark:hover:text-indigo-400 transition-all duration-300">+62 812-3456-7890</a></li>
                    <li>Jl. Makanan Enak No. 123, Jakarta</li>
                </ul>
            </div>
        </div>
        <div class="max-w-7xl mx-auto mt-6 sm:mt-8 text-center text-gray-500 dark:text-gray-400 text-xs sm:text-sm">
            &copy; 2025 FoodieHub. Dibuat dengan ❤️ untuk pecinta kuliner.
        </div>
    </footer>

    <script>
        // Ganti dengan URL dan Anon Key Supabase Anda
        const supabaseUrl = 'https://your-supabase-url.supabase.co';
        const supabaseKey = 'your-anon-key';
        const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

        let selectedProduct = null;
        let quantity = 1;
        let allProducts = [];
        let currentSlide = 0;

        // Sidebar toggle
        const sidebarToggle = document.getElementById('sidebar-toggle');
        const sidebarClose = document.getElementById('sidebar-close');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebar-overlay');

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        });

        sidebarClose.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        });

        // Slider functionality
        const sliderData = [
            { image: 'https://via.placeholder.com/1200x400?text=Promo+1', title: 'Promo Spesial', description: 'Dapatkan diskon 20% untuk semua pizza!' },
            { image: 'https://via.placeholder.com/1200x400?text=Promo+2', title: 'Makan Hemat', description: 'Beli 2 gratis 1 untuk menu tertentu.' },
            { image: 'https://via.placeholder.com/1200x400?text=Promo+3', title: 'Paket Keluarga', description: 'Paket lengkap untuk 4 orang hanya Rp 150.000!' }
        ];

        function renderSlider() {
            const sliderContainer = document.getElementById('slider-container');
            sliderContainer.innerHTML = '';
            sliderData.forEach((slide, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = `w-full flex-shrink-0 bg-cover bg-center ${index === 0 ? 'opacity-100' : 'opacity-0 hidden'}`;
                slideDiv.style.backgroundImage = `url(${slide.image})`;
                slideDiv.innerHTML = `
                    <div class="h-full flex items-center justify-center bg-black bg-opacity-50">
                        <div class="text-center text-white p-4">
                            <h3 class="text-xl sm:text-2xl lg:text-3xl font-bold mb-2">${slide.title}</h3>
                            <p class="text-sm sm:text-base lg:text-lg">${slide.description}</p>
                        </div>
                    </div>
                `;
                sliderContainer.appendChild(slideDiv);
            });
        }

        function showSlide(index) {
            const slides = document.querySelectorAll('#slider-container > div');
            slides.forEach((slide, i) => {
                slide.classList.toggle('opacity-100', i === index);
                slide.classList.toggle('hidden', i !== index);
            });
            currentSlide = index;
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % sliderData.length;
            showSlide(currentSlide);
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + sliderData.length) % sliderData.length;
            showSlide(currentSlide);
        }

        document.getElementById('slider-prev').addEventListener('click', prevSlide);
        document.getElementById('slider-next').addEventListener('click', nextSlide);

        // Auto slide every 5 seconds
        let slideInterval = setInterval(nextSlide, 5000);

        // Pause auto slide on hover
        document.getElementById('slider').addEventListener('mouseenter', () => clearInterval(slideInterval));
        document.getElementById('slider').addEventListener('mouseleave', () => slideInterval = setInterval(nextSlide, 5000));

        // Fungsi untuk fetch dan render produk
        async function fetchProducts() {
            showLoading(true);
            const { data, error } = await supabase
                .from('products')
                .select('*');

            showLoading(false);
            if (error) {
                console.error('Error fetching products:', error);
                alert('Gagal memuat produk. Silakan coba lagi.');
                return;
            }

            allProducts = data;
            renderProducts(allProducts);
        }

        function renderProducts(products) {
            const grid = document.getElementById('product-grid');
            grid.innerHTML = '';
            const noResults = document.getElementById('no-results');
            noResults.classList.add('hidden');

            if (products.length === 0) {
                noResults.classList.remove('hidden');
                return;
            }

            products.forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'bg-white dark:bg-gray-800 shadow-lg rounded-2xl overflow-hidden transform hover:scale-105 hover:shadow-2xl transition-all duration-500 cursor-pointer opacity-0 animate-fadeIn';
                card.style.animationDelay = `${index * 100}ms`;
                card.innerHTML = `
                    <img src="${product.image_url}" alt="${product.name}" class="w-full h-36 sm:h-40 lg:h-48 object-cover" loading="lazy">
                    <div class="p-4 sm:p-5">
                        <h3 class="text-base sm:text-lg lg:text-xl font-bold text-gray-800 dark:text-white truncate">${product.name}</h3>
                        <p class="text-gray-500 dark:text-gray-400 text-xs sm:text-sm mt-1 line-clamp-2">${product.description}</p>
                        <p class="text-sm sm:text-base lg:text-lg font-semibold text-green-600 mt-3">Rp ${product.price.toLocaleString()}</p>
                    </div>
                `;
                card.onclick = () => openProductModal(product);
                grid.appendChild(card);
            });
        }

        // Search functionality
        document.getElementById('search-input').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filtered = allProducts.filter(p => p.name.toLowerCase().includes(searchTerm) || p.description.toLowerCase().includes(searchTerm));
            renderProducts(filtered);
        });

        // Theme toggle
        const themeToggle = document.getElementById('theme-toggle');
        themeToggle.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            const icon = themeToggle.querySelector('i');
            icon.classList.toggle('fa-moon');
            icon.classList.toggle('fa-sun');
            localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
        });

        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeToggle.querySelector('i').classList.add('fa-sun');
            themeToggle.querySelector('i').classList.remove('fa-moon');
        }

        // Show/hide loading
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }

        // Fungsi buka modal produk
        function openProductModal(product) {
            selectedProduct = product;
            quantity = 1;
            document.getElementById('modal-title').textContent = product.name;
            document.getElementById('modal-image').src = product.image_url;
            document.getElementById('modal-description').textContent = product.description;
            document.getElementById('modal-price').textContent = `Rp ${product.price.toLocaleString()} / item`;
            updateTotalPrice();
            document.getElementById('product-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('product-modal').querySelector('div').classList.remove('scale-90');
            }, 10);

            document.getElementById('quantity').addEventListener('input', (e) => {
                quantity = parseInt(e.target.value) || 1;
                updateTotalPrice();
            });

            document.getElementById('buy-button').onclick = () => {
                closeModal('product-modal');
                document.getElementById('checkout-total').textContent = `Total: Rp ${(product.price * quantity).toLocaleString()}`;
                document.getElementById('checkout-modal').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('checkout-modal').querySelector('div').classList.remove('scale-90');
                }, 10);
            };
        }

        function updateTotalPrice() {
            document.getElementById('total-price').textContent = `Total: Rp ${(selectedProduct.price * quantity).toLocaleString()}`;
        }

        // Fungsi tutup modal
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.querySelector('div').classList.add('scale-90');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 500);
        }

        // Handle form checkout
        document.getElementById('checkout-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!e.target.checkValidity()) {
                e.target.reportValidity();
                return;
            }
            const name = document.getElementById('name').value;
            const address = document.getElementById('address').value;
            const phone = document.getElementById('phone').value;

            const { data, error } = await supabase
                .from('orders')
                .insert([
                    {
                        product_id: selectedProduct.id,
                        quantity: quantity,
                        name,
                        address,
                        phone,
                        total_price: selectedProduct.price * quantity,
                        status: 'pending'
                    }
                ]);

            if (error) {
                console.error('Error inserting order:', error);
                alert('Gagal menyimpan pesanan. Silakan coba lagi.');
                return;
            }

            closeModal('checkout-modal');
            document.getElementById('cod-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('cod-modal').querySelector('div').classList.remove('scale-90');
            }, 10);

            document.getElementById('checkout-form').reset();
            selectedProduct = null;
            quantity = 1;
        });

        // Load products and slider on page load
        renderSlider();
        showSlide(0);
        fetchProducts();

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal('product-modal');
                closeModal('checkout-modal');
                closeModal('cod-modal');
                sidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
            }
        });

        // Custom CSS for fadeIn animation
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fadeIn {
                animation: fadeIn 0.5s ease-out forwards;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
