<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pemesanan Makanan â€” Demo</title>
  <!-- Tailwind CDN (quick start). Untuk produksi gunakan build Tailwind. -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Supabase JS CDN -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    /* Hide scroll when modal or sidebar is open */
    body.modal-open, body.sidebar-open {
      overflow: hidden;
    }
    /* Backdrop for sidebar */
    #sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 40;
    }
    #sidebar-backdrop.open {
      display: block;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- NAVBAR -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <img src="https://via.placeholder.com/150x50?text=FoodOrder+Logo" alt="FoodOrder Logo" class="h-10 w-auto" onerror="this.style.display='none'"/>
        <div>
          <div class="text-lg font-semibold">FoodOrder</div>
          <div class="text-xs text-gray-500">Pemesanan makanan cepat</div>
        </div>
      </div>
      <div class="flex-1 mx-6">
        <div class="relative">
          <svg class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" aria-hidden>
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="11" cy="11" r="5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <input id="search" type="search" placeholder="Cari makanan, merchant, kategori..." class="w-full border border-gray-200 rounded-xl py-2 pl-11 pr-4 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500" />
        </div>
      </div>
      <nav class="hidden md:flex items-center gap-3">
        <button id="btn-filter" class="text-sm px-3 py-2 rounded-lg border border-gray-200">Filter</button>
        <button id="btn-wishlist" class="text-sm px-3 py-2 rounded-lg border border-gray-200">Wishlist</button>
      </nav>
      <button id="mobile-menu-btn" class="md:hidden p-2">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      </button>
    </div>
  </header>
  <!-- MOBILE SIDEBAR -->
  <div id="sidebar-backdrop"></div>
  <div id="mobile-sidebar" class="fixed inset-y-0 right-0 z-50 w-64 bg-white shadow-lg translate-x-full transition duration-300 ease-in-out md:hidden">
    <div class="flex justify-end p-4">
      <button id="close-sidebar" class="p-2">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <nav class="flex flex-col p-4 space-y-4">
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Beranda</a>
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Menu</a>
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Wishlist</a>
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Kontak</a>
    </nav>
  </div>
  <!-- SLIDER / HERO -->
  <section class="max-w-6xl mx-auto px-4 py-6">
    <div id="hero" class="relative rounded-xl overflow-hidden bg-gradient-to-r from-emerald-500 to-emerald-400 text-white h-44 flex items-center">
      <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=1600&q=80&auto=format&fit=crop')] bg-cover bg-center"></div>
      <div class="relative z-10 max-w-4xl mx-auto px-6 flex items-center justify-between w-full">
        <div>
          <h1 class="text-2xl md:text-3xl font-bold">Nikmati Makanan Favoritmu</h1>
          <p class="mt-1 text-sm opacity-90">Pilih, pesan, dan chat langsung dengan operator lewat WhatsApp.</p>
        </div>
        <div class="hidden md:block">
          <button id="hero-action" class="bg-white text-emerald-600 px-4 py-2 rounded-lg font-medium">Lihat Menu</button>
        </div>
      </div>
    </div>
  </section>
  <!-- CATEGORY FILTERS -->
  <section class="max-w-6xl mx-auto px-4">
    <div id="categories" class="flex gap-3 overflow-auto py-3 scrollbar-hide"></div>
  </section>
  <!-- MAIN GRID -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4" id="produk-grid">
      <!-- cards injected here -->
    </div>
  </main>
  <!-- PRODUCT MODAL -->
  <div id="modal-produk" class="fixed inset-0 hidden z-50 items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/40" onclick="closeModal()"></div>
    <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full overflow-hidden">
      <img id="modal-gambar" class="w-full h-48 object-cover" src="" alt="gambar produk" />
      <div class="p-4">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 id="modal-nama" class="text-lg font-semibold"></h2>
            <p id="modal-merchant" class="text-xs text-gray-500 mt-1"></p>
          </div>
          <div class="text-right">
            <div id="modal-harga" class="text-lg font-bold text-rose-600"></div>
            <div id="modal-kategori" class="text-xs text-gray-400"></div>
          </div>
        </div>
        <p id="modal-deskripsi" class="mt-3 text-sm text-gray-600"></p>
        <div class="mt-3">
          <label class="text-xs text-gray-600">Jumlah Pesanan</label>
          <input id="modal-quantity" type="number" min="1" value="1" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div class="mt-4 grid grid-cols-2 gap-2">
          <button onclick="openCheckout()" class="col-span-2 bg-rose-600 text-white py-2 rounded-lg">Pesan Sekarang</button>
          <button onclick="closeModal()" class="col-span-2 border border-gray-200 py-2 rounded-lg">Tutup</button>
        </div>
      </div>
    </div>
  </div>
  <!-- CHECKOUT MODAL -->
  <div id="modal-checkout" class="fixed inset-0 hidden z-50 items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/40" onclick="closeCheckout()"></div>
    <form id="checkout-form" class="relative bg-white rounded-xl shadow-xl max-w-md w-full overflow-hidden p-4" onsubmit="event.preventDefault(); handleCheckout();">
      <h3 class="text-lg font-semibold">Form Checkout</h3>
      <p class="text-xs text-gray-500">Isi data lengkap untuk proses order via WhatsApp.</p>
      <div class="mt-3 space-y-3">
        <div>
          <label class="text-xs text-gray-600">Nama Lengkap</label>
          <input id="input-nama" required type="text" placeholder="Nama lengkap" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div>
          <label class="text-xs text-gray-600">Alamat (RT/RW)</label>
          <input id="input-alamat" required type="text" placeholder="Jl. Contoh No 1, RT 01 / RW 02" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div>
          <label class="text-xs text-gray-600">Nomor HP</label>
          <input id="input-hp" required type="tel" placeholder="0812xxxx" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div id="checkout-summary" class="text-sm text-gray-700 bg-gray-50 p-3 rounded-md">
          <!-- summary injected -->
        </div>
      </div>
      <div class="mt-4 flex gap-2">
        <button type="submit" class="flex-1 bg-emerald-600 text-white py-2 rounded-md">Konfirmasi & WhatsApp</button>
        <button type="button" onclick="closeCheckout()" class="flex-1 border border-gray-200 py-2 rounded-md">Batal</button>
      </div>
    </form>
  </div>
  <!-- SMALL TOAST -->
  <div id="toast" class="fixed bottom-6 right-6 hidden bg-black text-white text-sm px-4 py-2 rounded-md shadow-lg z-50"></div>
  <!-- FOOTER -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="md:col-span-2">
          <img src="https://via.placeholder.com/150x50?text=FoodOrder+Logo" alt="FoodOrder Logo" class="h-10 w-auto mb-4" onerror="this.style.display='none'"/>
          <p class="text-sm text-gray-300 mb-4">FoodOrder adalah platform pemesanan makanan online yang menghubungkan Anda dengan berbagai restoran terbaik. Pesan makanan favoritmu dengan mudah dan cepat!</p>
          <div class="flex space-x-4">
            <a href="#" aria-label="Facebook" class="text-gray-300 hover:text-emerald-400">
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
            </a>
            <a href="#" aria-label="Twitter" class="text-gray-300 hover:text-emerald-400">
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
            <a href="#" aria-label="Instagram" class="text-gray-300 hover:text-emerald-400">
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Navigasi</h3>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Beranda</a></li>
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Menu</a></li>
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Wishlist</a></li>
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Kontak</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Kontak Kami</h3>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="mailto:support@foodorder.com" class="hover:text-emerald-400 transition-colors">support@foodorder.com</a></li>
            <li><a href="tel:+6281234567890" class="hover:text-emerald-400 transition-colors">+62 812-3456-7890</a></li>
            <li>Jl. Contoh No. 123, Jakarta, Indonesia</li>
          </ul>
        </div>
      </div>
      <div class="mt-8 border-t border-gray-700 pt-6 text-center text-sm text-gray-400">
        <p>&copy; 2025 FoodOrder. All rights reserved.</p>
        <p class="mt-2">Dibuat dengan <span class="text-red-500">&hearts;</span> untuk pecinta kuliner.</p>
      </div>
    </div>
  </footer>
  <!-- SCRIPT: Supabase logic, render, interactions -->
  <script>
    /* --------------- CONFIG: ganti ini dengan credential Supabase Anda --------------- */
    const SUPABASE_URL = "https://dlnenwglsmfyhdysmqdc.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsbmVud2dsc21meWhkeXNtcWRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMTM5ODIsImV4cCI6MjA3MTY4OTk4Mn0.oWKClbQFN5RDS_MkFkPFbwel-LBmD8iGJX1KxN3Db0U";
    /* ------------------------------------------------------------------------------- */
    if (!SUPABASE_URL || !SUPABASE_ANON) {
      console.error("Supabase credential belum diisi. Ganti SUPABASE_URL dan SUPABASE_ANON.");
    }
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
    // State
    let produkData = [];
    let operatorData = [];
    let kategoriSet = new Set();
    let selectedProduk = null;
    let selectedQuantity = 1;
    // WA rotation pointer stored in localStorage to persist between sessions
    const WA_INDEX_KEY = "wa_rotation_index";
    function getWaIndex() {
      const v = parseInt(localStorage.getItem(WA_INDEX_KEY) || "0", 10);
      return isNaN(v) ? 0 : v;
    }
    function bumpWaIndex() {
      const next = getWaIndex() + 1;
      localStorage.setItem(WA_INDEX_KEY, String(next));
      return next;
    }
    // UTIL
    function rupiah(num) {
      if (num == null) return "";
      return "Rp" + Number(num).toLocaleString("id-ID");
    }
    function showToast(text, ms = 2500) {
      const t = document.getElementById("toast");
      t.innerText = text;
      t.classList.remove("hidden");
      setTimeout(() => t.classList.add("hidden"), ms);
    }
    // MOBILE SIDEBAR CONTROLS
    const sidebar = document.getElementById("mobile-sidebar");
    const backdrop = document.getElementById("sidebar-backdrop");
    document.getElementById("mobile-menu-btn").addEventListener("click", () => {
      sidebar.classList.toggle("translate-x-full");
      backdrop.classList.toggle("open");
      document.body.classList.toggle("sidebar-open");
    });
    document.getElementById("close-sidebar").addEventListener("click", () => {
      sidebar.classList.add("translate-x-full");
      backdrop.classList.remove("open");
      document.body.classList.remove("sidebar-open");
    });
    document.getElementById("sidebar-backdrop").addEventListener("click", () => {
      sidebar.classList.add("translate-x-full");
      backdrop.classList.remove("open");
      document.body.classList.remove("sidebar-open");
    });
    // LOAD DATA FROM SUPABASE
    async function loadData() {
      try {
        const { data: produk, error: err1 } = await supabaseClient
          .from("produk")
          .select("id,nama,deskripsi,harga,gambar,merchant,alamat,kategori")
          .order("id", { ascending: true });
        const { data: msgs, error: err2 } = await supabaseClient
          .from("message")
          .select("id,nomor")
          .order("id", { ascending: true });
        if (err1) console.error("Error fetch produk:", err1);
        if (err2) console.error("Error fetch message:", err2);
        produkData = produk || [];
        operatorData = (msgs || []).map(m => ({ id: m.id, nomor: String(m.nomor).replace(/\D/g, "") }));
        // build categories
        kategoriSet = new Set(produkData.map(p => p.kategori || "Umum"));
        renderCategories();
        renderProduk(produkData);
      } catch (e) {
        console.error("loadData failed", e);
        showToast("Gagal mengambil data. Periksa konsol.");
      }
    }
    // RENDER CATEGORIES
    function renderCategories() {
      const wrap = document.getElementById("categories");
      wrap.innerHTML = "";
      // "Semua" button
      const btnAll = document.createElement("button");
      btnAll.className = "px-3 py-2 bg-white border border-gray-200 rounded-full text-sm whitespace-nowrap";
      btnAll.innerText = "Semua";
      btnAll.onclick = () => renderProduk(produkData);
      wrap.appendChild(btnAll);
      Array.from(kategoriSet).forEach(k => {
        const btn = document.createElement("button");
        btn.className = "px-3 py-2 bg-white border border-gray-200 rounded-full text-sm whitespace-nowrap";
        btn.innerText = k;
        btn.onclick = () => {
          const filtered = produkData.filter(p => (p.kategori || "Umum") === k);
          renderProduk(filtered);
        };
        wrap.appendChild(btn);
      });
    }
    // RENDER PRODUCT GRID
    function renderProduk(list) {
      const grid = document.getElementById("produk-grid");
      grid.innerHTML = "";
      if (!list.length) {
        grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-8">Produk tidak ditemukan</div>`;
        return;
      }
      for (const item of list) {
        const card = document.createElement("article");
        card.className = "bg-white rounded-xl overflow-hidden shadow hover:shadow-lg transition cursor-pointer";
        const img = document.createElement("img");
        img.src = item.gambar || "";
        img.alt = item.nama || "";
        img.className = "h-40 w-full object-cover";
        const body = document.createElement("div");
        body.className = "p-3";
        const title = document.createElement("h3");
        title.className = "text-sm font-semibold";
        title.innerText = item.nama || "â€”";
        const merchant = document.createElement("p");
        merchant.className = "text-xs text-gray-500 mt-1";
        merchant.innerText = item.merchant || "";
        const row = document.createElement("div");
        row.className = "mt-3 flex items-center justify-between gap-2";
        const price = document.createElement("div");
        price.className = "text-sm font-bold text-rose-600";
        price.innerText = rupiah(item.harga);
        const btn = document.createElement("button");
        btn.className = "text-xs bg-emerald-600 text-white px-3 py-1 rounded-md";
        btn.innerText = "Detail";
        btn.onclick = (e) => {
          e.stopPropagation();
          openModal(item);
        };
        row.appendChild(price);
        row.appendChild(btn);
        body.appendChild(title);
        body.appendChild(merchant);
        body.appendChild(row);
        card.appendChild(img);
        card.appendChild(body);
        card.addEventListener("click", () => openModal(item));
        grid.appendChild(card);
      }
    }
    // SEARCH
    document.getElementById("search").addEventListener("input", (ev) => {
      const v = ev.target.value.trim().toLowerCase();
      if (!v) return renderProduk(produkData);
      const filtered = produkData.filter(p =>
        (p.nama || "").toLowerCase().includes(v) ||
        (p.deskripsi || "").toLowerCase().includes(v) ||
        (p.merchant || "").toLowerCase().includes(v) ||
        (p.kategori || "").toLowerCase().includes(v)
      );
      renderProduk(filtered);
    });
    // MODAL CONTROLS
    function openModal(item) {
      selectedProduk = item;
      selectedQuantity = 1; // Reset quantity
      document.getElementById("modal-gambar").src = item.gambar || "";
      document.getElementById("modal-nama").innerText = item.nama || "";
      document.getElementById("modal-merchant").innerText = item.merchant || "";
      document.getElementById("modal-deskripsi").innerText = item.deskripsi || "";
      document.getElementById("modal-harga").innerText = rupiah(item.harga);
      document.getElementById("modal-kategori").innerText = item.kategori || "";
      document.getElementById("modal-quantity").value = 1;
      document.getElementById("modal-produk").classList.remove("hidden");
      document.body.classList.add("modal-open");
    }
    function closeModal() {
      document.getElementById("modal-produk").classList.add("hidden");
      document.body.classList.remove("modal-open");
    }
    function openCheckout() {
      if (!selectedProduk) return showToast("Pilih produk terlebih dahulu.");
      selectedQuantity = parseInt(document.getElementById("modal-quantity").value, 10) || 1;
      if (selectedQuantity < 1) {
        showToast("Jumlah pesanan minimal 1.");
        return;
      }
      const sum = document.getElementById("checkout-summary");
      sum.innerHTML = `
        <div class="font-semibold">${selectedProduk.nama}</div>
        <div class="text-xs text-gray-500">${selectedProduk.merchant} â€¢ ${selectedProduk.alamat || ""}</div>
        <div class="mt-2">Jumlah: ${selectedQuantity}</div>
        <div class="mt-2 text-rose-600 font-bold">Total: ${rupiah(selectedProduk.harga * selectedQuantity)}</div>
      `;
      document.getElementById("input-nama").value = "";
      document.getElementById("input-alamat").value = "";
      document.getElementById("input-hp").value = "";
      closeModal();
      document.getElementById("modal-checkout").classList.remove("hidden");
      document.body.classList.add("modal-open");
    }
    function closeCheckout() {
      document.getElementById("modal-checkout").classList.add("hidden");
      document.body.classList.remove("modal-open");
    }
    // VALIDASI NOMOR HP
    function normalizeHp(raw) {
      if (!raw) return "";
      let s = String(raw).trim().replace(/\s+/g, "");
      s = s.replace(/^(\+62|62)/, "0");
      if (s.startsWith("0")) return "62" + s.slice(1);
      if (s.startsWith("62")) return s;
      return s;
    }
    // HANDLE CHECKOUT
    function handleCheckout() {
      const nama = document.getElementById("input-nama").value.trim();
      const alamat = document.getElementById("input-alamat").value.trim();
      const hpRaw = document.getElementById("input-hp").value.trim();
      const hp = normalizeHp(hpRaw);
      if (!nama || !alamat || !hp) {
        return showToast("Lengkapi semua form checkout.");
      }
      if (!selectedProduk) return showToast("Produk tidak tersedia.");
      if (!operatorData.length) {
        return showToast("Tidak ada nomor operator. Hubungi admin.");
      }
      const idx = getWaIndex() % operatorData.length;
      bumpWaIndex();
      const operator = operatorData[idx];
      const totalHarga = selectedProduk.harga * selectedQuantity;
      const list = [
        `Halo Admin, saya ingin pesan:`,
        `Nama: ${nama}`,
        `Alamat: ${alamat}`,
        `HP: ${hpRaw}`,
        `Merchant: ${selectedProduk.merchant || "-"}`,
        `Produk: ${selectedProduk.nama || "-"} (${selectedProduk.kategori || "-"})`,
        `Jumlah: ${selectedQuantity}`,
        `Harga Satuan: ${rupiah(selectedProduk.harga)}`,
        `Total Harga: ${rupiah(totalHarga)}`,
        `---`,
        `*Catatan:*`
      ];
      const text = encodeURIComponent(list.join("\n"));
      const waNumber = String(operator.nomor).replace(/\D/g, "");
      if (!waNumber) return showToast("Nomor operator tidak valid.");
      const url = `https://wa.me/${waNumber}?text=${text}`;
      window.open(url, "_blank");
      try {
        const history = JSON.parse(localStorage.getItem("orders") || "[]");
        history.unshift({
          produkId: selectedProduk.id,
          produkNama: selectedProduk.nama,
          harga: selectedProduk.harga,
          jumlah: selectedQuantity,
          total: totalHarga,
          nama,
          alamat,
          hp: hpRaw,
          operator: waNumber,
          ts: new Date().toISOString()
        });
        localStorage.setItem("orders", JSON.stringify(history.slice(0, 50)));
      } catch (e) { /* ignore */ }
      closeCheckout();
      showToast("Mengarahkan ke WhatsApp operator...");
    }
    // INIT
    loadData();
    // HERO ACTION SCROLL
    document.getElementById("hero-action")?.addEventListener("click", () => {
      document.getElementById("produk-grid").scrollIntoView({ behavior: "smooth", block: "start" });
    });
    // ACCESSIBILITY: CLOSE MODALS AND SIDEBAR WITH ESC
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeModal();
        closeCheckout();
        sidebar.classList.add("translate-x-full");
        backdrop.classList.remove("open");
        document.body.classList.remove("sidebar-open");
      }
    });
  </script>
</body>
</html>
