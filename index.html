<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pemesanan Makanan — FoodOrder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body.modal-open, body.sidebar-open {
      overflow: hidden;
    }
    #sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 40;
    }
    #sidebar-backdrop.open {
      display: block;
    }
    #toast.error {
      background-color: #dc2626;
      color: white;
      font-weight: bold;
      font-size: 1rem;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      max-width: 90%;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }
    #categories {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    #categories::-webkit-scrollbar {
      display: none;
    }
    #categories button {
      scroll-snap-align: start;
      flex: 0 0 auto;
      margin-right: 0.75rem;
    }
    #produk-grid {
      display: flex;
      overflow-x: auto;
      scroll-snap-type: x proximity;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: #d1d5db transparent;
    }
    #produk-grid::-webkit-scrollbar {
      height: 8px;
    }
    #produk-grid::-webkit-scrollbar-thumb {
      background-color: #d1d5db;
      border-radius: 4px;
    }
    #produk-grid article {
      flex: 0 0 200px;
      margin-right: 1rem;
      scroll-snap-align: start;
    }
    #hero-slider {
      position: relative;
      overflow: hidden;
    }
    .slider-item {
      display: none;
      animation: fadeIn 0.5s ease-in-out;
    }
    .slider-item.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .slider-dots {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.5rem;
    }
    .slider-dot {
      width: 10px;
      height: 10px;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      cursor: pointer;
    }
    .slider-dot.active {
      background: white;
    }
    body {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    #search-container {
      position: sticky;
      top: 4.5rem;
      z-index: 30;
      background: white;
      padding: 0.5rem 0;
    }
    #search-button {
      cursor: pointer;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <script>
    document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        e.key === 'F12' ||
        (e.ctrlKey && e.shiftKey && ['I', 'C', 'J'].includes(e.key)) ||
        (e.ctrlKey && e.key === 'U')
      ) {
        e.preventDefault();
      }
    });
  </script>
  <!-- NAVBAR -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
      <div class="flex items-center gap-3">
        <img src="https://via.placeholder.com/150x50?text=FoodOrder+Logo" alt="FoodOrder Logo" class="h-10 w-auto" onerror="this.style.display='none'"/>
        <div>
          <div class="text-lg font-semibold">FoodOrder</div>
          <div class="text-xs text-gray-500">Pesan Makanan Online</div>
        </div>
      </div>
      <nav class="hidden md:flex items-center gap-3">
        <button id="btn-filter" class="text-sm px-3 py-2 rounded-lg border border-gray-200 hover:bg-emerald-50">Filter</button>
        <button id="btn-wishlist" class="text-sm px-3 py-2 rounded-lg border border-gray-200 hover:bg-emerald-50">Wishlist</button>
      </nav>
      <button id="mobile-menu-btn" class="md:hidden p-2">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
      </button>
    </div>
  </header>
  <!-- SEARCH BAR -->
  <div id="search-container" class="max-w-6xl mx-auto px-4">
    <div class="relative">
      <svg id="search-button" class="absolute left-3 top-2.5 h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none" aria-hidden>
        <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="11" cy="11" r="5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <input id="search" type="search" placeholder="Cari makanan, merchant, kategori..." class="w-full border border-gray-200 rounded-xl py-2 pl-11 pr-4 text-sm focus:outline-none focus:ring-1 focus:ring-emerald-500" />
    </div>
  </div>
  <!-- MOBILE SIDEBAR -->
  <div id="sidebar-backdrop"></div>
  <div id="mobile-sidebar" class="fixed inset-y-0 right-0 z-50 w-64 bg-white shadow-lg translate-x-full transition duration-300 ease-in-out md:hidden">
    <div class="flex justify-end p-4">
      <button id="close-sidebar" class="p-2">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="none">
          <path d="M6 18L18 6M6 6l12 12" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <nav class="flex flex-col p-4 space-y-4">
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Beranda</a>
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Menu</a>
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Wishlist</a>
      <a href="#" class="text-sm font-medium hover:text-emerald-600">Kontak</a>
    </nav>
  </div>
  <!-- SLIDER / HERO -->
  <section class="max-w-6xl mx-auto px-4 py-6">
    <div id="hero-slider" class="relative rounded-xl overflow-hidden">
      <div class="slider-item active">
        <div class="bg-gradient-to-r from-emerald-500 to-emerald-400 text-white h-44 flex items-center relative">
          <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=1600&q=80&auto=format&fit=crop')] bg-cover bg-center"></div>
          <div class="relative z-10 max-w-4xl mx-auto px-6 flex items-center justify-between w-full">
            <div>
              <h1 class="text-2xl md:text-3xl font-bold">Nikmati Makanan Favoritmu</h1>
              <p class="mt-1 text-sm opacity-90">Pilih, pesan, dan nikmati makanan lezat dengan cepat.</p>
            </div>
            <div class="hidden md:block">
              <button id="hero-action-1" class="bg-white text-emerald-600 px-4 py-2 rounded-lg font-medium">Lihat Menu</button>
            </div>
          </div>
        </div>
      </div>
      <div class="slider-item">
        <div class="bg-gradient-to-r from-rose-500 to-rose-400 text-white h-44 flex items-center relative">
          <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1513106580091-1d82408b8f6a?w=1600&q=80&auto=format&fit=crop')] bg-cover bg-center"></div>
          <div class="relative z-10 max-w-4xl mx-auto px-6 flex items-center justify-between w-full">
            <div>
              <h1 class="text-2xl md:text-3xl VITAMIN C">Promo Spesial Hari Ini!</h1>
              <p class="mt-1 text-sm opacity-90">Dapatkan diskon hingga 50% untuk pesanan pertama.</p>
            </div>
            <div class="hidden md:block">
              <button id="hero-action-2" class="bg-white text-rose-600 px-4 py-2 rounded-lg font-medium">Pesan Sekarang</button>
            </div>
          </div>
        </div>
      </div>
      <div class="slider-item">
        <div class="bg-gradient-to-r from-blue-500 to-blue-400 text-white h-44 flex items-center relative">
          <div class="absolute inset-0 opacity-20 bg-[url('https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?w=1600&q=80&auto=format&fit=crop')] bg-cover bg-center"></div>
          <div class="relative z-10 max-w-4xl mx-auto px-6 flex items-center justify-between w-full">
            <div>
              <h1 class="text-2xl md:text-3xl font-bold">Kuliner Nusantara</h1>
              <p class="mt-1 text-sm opacity-90">Jelajahi cita rasa lokal dari berbagai daerah.</p>
            </div>
            <div class="hidden md:block">
              <button id="hero-action-3" class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium">Eksplor Sekarang</button>
            </div>
          </div>
        </div>
      </div>
      <div class="slider-dots"></div>
    </div>
  </section>
  <!-- ADVANTAGES SECTION -->
  <section class="max-w-6xl mx-auto px-4 py-6">
    <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Mengapa Memilih FoodOrder?</h2>
    <p class="text-center text-gray-600 mb-8">Kami menghadirkan pengalaman kuliner terbaik dengan layanan cepat dan terpercaya.</p>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="bg-white p-6 rounded-xl shadow-lg text-center hover:shadow-xl transition">
        <svg class="h-12 w-12 mx-auto mb-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <h3 class="text-lg font-semibold">Pesanan Cepat</h3>
        <p class="text-sm text-gray-600 mt-2">Proses pemesanan mudah dan pengiriman dalam hitungan menit.</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg text-center hover:shadow-xl transition">
        <svg class="h-12 w-12 mx-auto mb-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        <h3 class="text-lg font-semibold">Layanan 24/7</h3>
        <p class="text-sm text-gray-600 mt-2">Kami siap melayani kapan saja, siang maupun malam.</p>
      </div>
      <div class="bg-white p-6 rounded-xl shadow-lg text-center hover:shadow-xl transition">
        <svg class="h-12 w-12 mx-auto mb-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a5 5 0 00-10 0v2m-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5m-2-2H5"/>
        </svg>
        <h3 class="text-lg font-semibold">Pembayaran Aman</h3>
        <p class="text-sm text-gray-600 mt-2">Transaksi terjamin aman dengan teknologi terpercaya.</p>
      </div>
    </div>
  </section>
  <!-- POPULAR RESTAURANTS -->
  <section class="max-w-6xl mx-auto px-4 py-6">
    <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Restoran Populer</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <img src="https://images.unsplash.com/photo-1517248135467-2c7ed3ab7229?w=400&q=80&auto=format&fit=crop" alt="Restoran 1" class="h-32 w-full object-cover"/>
        <div class="p-4">
          <h3 class="text-lg font-semibold">Warung Makan Sederhana</h3>
          <p class="text-sm text-gray-600">Masakan khas Indonesia dengan cita rasa otentik.</p>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <img src="https://images.unsplash.com/photo-1552566626-52f8b828add9?w=400&q=80&auto=format&fit=crop" alt="Restoran 2" class="h-32 w-full object-cover"/>
        <div class="p-4">
          <h3 class="text-lg font-semibold">Cafe Bintang</h3>
          <p class="text-sm text-gray-600">Nikmati kopi dan makanan ringan dalam suasana cozy.</p>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <img src="https://images.unsplash.com/photo-1578474846511-04ba529f0d64?w=400&q=80&auto=format&fit=crop" alt="Restoran 3" class="h-32 w-full object-cover"/>
        <div class="p-4">
          <h3 class="text-lg font-semibold">Dapur Nusantara</h3>
          <p class="text-sm text-gray-600">Hidangan tradisional dari berbagai daerah.</p>
        </div>
      </div>
      <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <img src="https://images.unsplash.com/photo-1514933651103-4d3c5e7b89f7?w=400&q=80&auto=format&fit=crop" alt="Restoran 4" class="h-32 w-full object-cover"/>
        <div class="p-4">
          <h3 class="text-lg font-semibold">Resto Seaside</h3>
          <p class="text-sm text-gray-600">Makanan laut segar dengan pemandangan indah.</p>
        </div>
      </div>
    </div>
  </section>
  <!-- CATEGORY AND FILTER -->
  <section class="max-w-6xl mx-auto px-4 py-4">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Kategori</h2>
      <div class="flex gap-2">
        <select id="price-filter" class="border border-gray-200 rounded-md px-3 py-2 text-sm">
          <option value="">Filter Harga</option>
          <option value="0-25000">Rp0 - Rp25.000</option>
          <option value="25001-50000">Rp25.001 - Rp50.000</option>
          <option value="50001-100000">Rp50.001 - Rp100.000</option>
          <option value="100001+">> Rp100.000</option>
        </select>
      </div>
    </div>
    <div id="categories" class="flex gap-3 py-3"></div>
  </section>
  <!-- MAIN GRID -->
  <main class="max-w-6xl mx-auto px-4 py-6">
    <div id="produk-grid" class="flex gap-4"></div>
  </main>
  <!-- PRODUCT MODAL -->
  <div id="modal-produk" class="fixed inset-0 hidden z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/40" onclick="closeModal()"></div>
    <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full overflow-hidden">
      <img id="modal-gambar" class="w-full h-48 object-cover" src="" alt="gambar produk" />
      <div class="p-4">
        <div class="flex items-start justify-between gap-3">
          <div>
            <h2 id="modal-nama" class="text-lg font-semibold"></h2>
            <p id="modal-merchant" class="text-xs text-gray-500 mt-1"></p>
          </div>
          <div class="text-right">
            <div id="modal-harga" class="text-lg font-bold text-rose-600"></div>
            <div id="modal-kategori" class="text-xs text-gray-400"></div>
          </div>
        </div>
        <p id="modal-deskripsi" class="mt-3 text-sm text-gray-600"></p>
        <div class="mt-3 flex items-center gap-2">
          <label class="text-xs text-gray-600">Jumlah Pesanan</label>
          <div class="flex items-center border border-gray-200 rounded-md">
            <button id="decrease-quantity" class="px-3 py-1 text-gray-600 hover:bg-gray-100">-</button>
            <span id="modal-quantity" class="px-3 py-1 text-sm">1</span>
            <button id="increase-quantity" class="px-3 py-1 text-gray-600 hover:bg-gray-100">+</button>
          </div>
        </div>
        <div class="mt-4 grid grid-cols-2 gap-2">
          <button onclick="openCheckout()" class="col-span-2 bg-rose-600 text-white py-2 rounded-lg hover:bg-rose-700">Pesan Sekarang</button>
          <button onclick="closeModal()" class="col-span-2 border border-gray-200 py-2 rounded-lg hover:bg-gray-100">Tutup</button>
        </div>
      </div>
    </div>
  </div>
  <!-- CHECKOUT MODAL -->
  <div id="modal-checkout" class="fixed inset-0 hidden z-50 flex items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/40" onclick="closeCheckout()"></div>
    <div class="relative bg-white rounded-xl shadow-xl max-w-md w-full overflow-hidden p-4">
      <h3 class="text-lg font-semibold">Form Checkout</h3>
      <p class="text-xs text-gray-500">Isi data lengkap untuk proses order via WhatsApp.</p>
      <div class="mt-3 space-y-3">
        <div>
          <label class="text-xs text-gray-600">Nama Lengkap</label>
          <input id="input-nama" required type="text" placeholder="Nama anda" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div>
          <label class="text-xs text-gray-600">Alamat (RT/RW)</label>
          <input id="input-alamat" required type="text" placeholder="Jl. Contoh No 1, RT 01 / RW 02" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div>
          <label class="text-xs text-gray-600">Nomor HP-WhatsApp</label>
          <input id="input-hp" required type="tel" placeholder="0812xxxx" class="w-full border border-gray-200 rounded-md px-3 py-2 mt-1 text-sm" />
        </div>
        <div id="checkout-summary" class="text-sm text-gray-700 bg-gray-50 p-3 rounded-md"></div>
      </div>
      <div class="mt-4 flex gap-2">
        <button onclick="handleCheckout()" class="flex-1 bg-emerald-600 text-white py-2 rounded-md hover:bg-emerald-700">Proses</button>
        <button onclick="closeCheckout()" class="flex-1 border border-gray-200 py-2 rounded-md hover:bg-gray-100">Batal</button>
      </div>
    </div>
  </div>
  <!-- SMALL TOAST -->
  <div id="toast" class="fixed hidden bg-black text-white text-sm px-4 py-2 rounded-md shadow-lg z-50"></div>
  <!-- FOOTER -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="max-w-6xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div class="md:col-span-2">
          <img src="https://via.placeholder.com/150x50?text=FoodOrder+Logo" alt="FoodOrder Logo" class="h-10 w-auto mb-4" onerror="this.style.display='none'"/>
          <p class="text-sm text-gray-300 mb-4">FoodOrder adalah platform pemesanan makanan online yang menghubungkan Anda dengan berbagai restoran terbaik. Pesan makanan favoritmu dengan mudah dan cepat!</p>
          <div class="flex space-x-4">
            <a href="#" aria-label="Facebook" class="text-gray-300 hover:text-emerald-400">
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"/></svg>
            </a>
            <a href="#" aria-label="Twitter" class="text-gray-300 hover:text-emerald-400">
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
            </a>
            <a href="#" aria-label="Instagram" class="text-gray-300 hover:text-emerald-400">
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
            </a>
          </div>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Navigasi</h3>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Beranda</a></li>
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Menu</a></li>
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Wishlist</a></li>
            <li><a href="#" class="hover:text-emerald-400 transition-colors">Kontak</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-semibold mb-4">Kontak Kami</h3>
          <ul class="space-y-2 text-sm text-gray-300">
            <li><a href="mailto:support@foodorder.com" class="hover:text-emerald-400 transition-colors">support@foodorder.com</a></li>
            <li><a href="tel:+6281234567890" class="hover:text-emerald-400 transition-colors">+62 812-3456-7890</a></li>
            <li>Jl. Contoh No. 123, Jakarta, Indonesia</li>
          </ul>
        </div>
      </div>
      <div class="mt-8 border-t border-gray-700 pt-6 text-center text-sm text-gray-400">
        <p>&copy; 2025 FoodOrder. All rights reserved.</p>
        <p class="mt-2">Dibuat dengan <span class="text-red-500">&hearts;</span> untuk pecinta kuliner.</p>
      </div>
    </div>
  </footer>
  <!-- SCRIPT -->
  <script>
    const SUPABASE_URL = "https://dlnenwglsmfyhdysmqdc.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsbmVud2dsc21meWhkeXNtcWRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxMTM5ODIsImV4cCI6MjA3MTY4OTk4Mn0.oWKClbQFN5RDS_MkFkPFbwel-LBmD8iGJX1KxN3Db0U";
    if (!SUPABASE_URL || !SUPABASE_ANON) {
      showErrorToast("Konfigurasi Supabase tidak lengkap. Hubungi admin.");
      throw new Error("Supabase credential belum diisi. Ganti SUPABASE_URL dan SUPABASE_ANON.");
    }
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
    let produkData = [];
    let operatorData = [];
    let kategoriSet = new Set();
    let selectedProduk = null;
    let selectedQuantity = 1;
    const WA_INDEX_KEY = "wa_rotation_index";
    function getWaIndex() {
      const v = parseInt(localStorage.getItem(WA_INDEX_KEY) || "0", 10);
      return isNaN(v) ? 0 : v;
    }
    function bumpWaIndex() {
      const next = getWaIndex() + 1;
      localStorage.setItem(WA_INDEX_KEY, String(next));
      return next;
    }
    function rupiah(num) {
      if (num == null) {
        showErrorToast("Harga produk tidak valid.");
        return "";
      }
      return "Rp" + Number(num).toLocaleString("id-ID");
    }
    function showToast(text, ms = 2500, isError = false) {
      const t = document.getElementById("toast");
      t.innerText = text;
      t.classList.remove("hidden", "error");
      if (isError) {
        t.classList.add("error");
        ms = 3500;
      }
      setTimeout(() => t.classList.add("hidden"), ms);
    }
    function showErrorToast(text) {
      showToast(text, 3500, true);
    }
    // MOBILE SIDEBAR
    const sidebar = document.getElementById("mobile-sidebar");
    const backdrop = document.getElementById("sidebar-backdrop");
    document.getElementById("mobile-menu-btn").addEventListener("click", () => {
      try {
        sidebar.classList.toggle("translate-x-full");
        backdrop.classList.toggle("open");
        document.body.classList.toggle("sidebar-open");
      } catch (e) {
        showErrorToast("Gagal membuka menu. Coba lagi.");
        console.error("Sidebar toggle failed", e);
      }
    });
    document.getElementById("close-sidebar").addEventListener("click", () => {
      try {
        sidebar.classList.add("translate-x-full");
        backdrop.classList.remove("open");
        document.body.classList.remove("sidebar-open");
      } catch (e) {
        showErrorToast("Gagal menutup menu. Coba lagi.");
        console.error("Sidebar close failed", e);
      }
    });
    document.getElementById("sidebar-backdrop").addEventListener("click", () => {
      try {
        sidebar.classList.add("translate-x-full");
        backdrop.classList.remove("open");
        document.body.classList.remove("sidebar-open");
      } catch (e) {
        showErrorToast("Gagal menutup menu. Coba lagi.");
        console.error("Sidebar backdrop close failed", e);
      }
    });
    // QUANTITY CONTROLS
    document.getElementById("increase-quantity").addEventListener("click", () => {
      try {
        if (selectedQuantity >= 99) {
          showErrorToast("Jumlah pesanan maksimal 99.");
          return;
        }
        selectedQuantity++;
        document.getElementById("modal-quantity").innerText = selectedQuantity;
      } catch (e) {
        showErrorToast("Gagal menambah jumlah pesanan.");
        console.error("Increase quantity failed", e);
      }
    });
    document.getElementById("decrease-quantity").addEventListener("click", () => {
      try {
        if (selectedQuantity <= 1) {
          showErrorToast("Jumlah pesanan minimal 1.");
          return;
        }
        selectedQuantity--;
        document.getElementById("modal-quantity").innerText = selectedQuantity;
      } catch (e) {
        showErrorToast("Gagal mengurangi jumlah pesanan.");
        console.error("Decrease quantity failed", e);
      }
    });
    // SLIDER LOGIC
    const sliderItems = document.querySelectorAll('.slider-item');
    const sliderDotsContainer = document.querySelector('.slider-dots');
    let currentSlide = 0;
    function createSliderDots() {
      sliderItems.forEach((_, index) => {
        const dot = document.createElement('div');
        dot.classList.add('slider-dot');
        if (index === 0) dot.classList.add('active');
        dot.addEventListener('click', () => goToSlide(index));
        sliderDotsContainer.appendChild(dot);
      });
    }
    function updateSlider() {
      sliderItems.forEach((item, index) => {
        item.classList.toggle('active', index === currentSlide);
      });
      document.querySelectorAll('.slider-dot').forEach((dot, index) => {
        dot.classList.toggle('active', index === currentSlide);
      });
    }
    function goToSlide(index) {
      currentSlide = (index + sliderItems.length) % sliderItems.length;
      updateSlider();
    }
    setInterval(() => goToSlide(currentSlide + 1), 5000);
    createSliderDots();
    // LOAD DATA
    async function loadData() {
      try {
        const { data: produk, error: err1 } = await supabaseClient
          .from("produk")
          .select("id,nama,deskripsi,harga,gambar,merchant,alamat,kategori")
          .order("id", { ascending: true });
        if (err1) {
          showErrorToast("Gagal memuat data produk. Coba lagi nanti.");
          throw new Error("Error fetch produk: " + err1.message);
        }
        const { data: msgs, error: err2 } = await supabaseClient
          .from("message")
          .select("id,nomor")
          .order("id", { ascending: true });
        if (err2) {
          showErrorToast("Gagal memuat data operator. Coba lagi nanti.");
          throw new Error("Error fetch message: " + err2.message);
        }
        produkData = produk || [];
        operatorData = (msgs || []).map(m => {
          const nomor = String(m.nomor).replace(/\D/g, "");
          if (!nomor) {
            showErrorToast("Nomor operator tidak valid.");
          }
          return { id: m.id, nomor };
        });
        if (!produkData.length) {
          showErrorToast("Tidak ada produk tersedia.");
        }
        if (!operatorData.length) {
          showErrorToast("Tidak ada operator tersedia. Hubungi admin.");
        }
        kategoriSet = new Set(produkData.map(p => p.kategori || "Umum"));
        renderCategories();
        renderProduk(produkData);
      } catch (e) {
        showErrorToast("Gagal memuat data. Periksa koneksi Anda.");
        console.error("loadData failed", e);
      }
    }
    // RENDER CATEGORIES
    function renderCategories() {
      try {
        const wrap = document.getElementById("categories");
        if (!wrap) {
          showErrorToast("Gagal menampilkan kategori.");
          throw new Error("Categories element not found");
        }
        wrap.innerHTML = "";
        const btnAll = document.createElement("button");
        btnAll.className = "px-4 py-2 bg-white border border-gray-200 rounded-full text-sm whitespace-nowrap hover:bg-emerald-50";
        btnAll.innerText = "Semua";
        btnAll.onclick = () => {
          try {
            document.getElementById("price-filter").value = "";
            renderProduk(produkData);
          } catch (e) {
            showErrorToast("Gagal menampilkan semua produk.");
            console.error("Render all products failed", e);
          }
        };
        wrap.appendChild(btnAll);
        Array.from(kategoriSet).forEach(k => {
          const btn = document.createElement("button");
          btn.className = "px-4 py-2 bg-white border border-gray-200 rounded-full text-sm whitespace-nowrap hover:bg-emerald-50";
          btn.innerText = k;
          btn.onclick = () => {
            try {
              const filtered = produkData.filter(p => (p.kategori || "Umum") === k);
              applyPriceFilter(filtered);
            } catch (e) {
              showErrorToast(`Gagal menampilkan produk kategori ${k}.`);
              console.error("Render category failed", e);
            }
          };
          wrap.appendChild(btn);
        });
      } catch (e) {
        showErrorToast("Gagal memuat kategori.");
        console.error("renderCategories failed", e);
      }
    }
    // PRICE FILTER
    function applyPriceFilter(data) {
      const priceFilter = document.getElementById("price-filter").value;
      let filtered = data;
      if (priceFilter) {
        const [min, max] = priceFilter.split("-").map(Number);
        filtered = data.filter(p => {
          if (max) return p.harga >= min && p.harga <= max;
          return p.harga >= min;
        });
      }
      renderProduk(filtered);
    }
    document.getElementById("price-filter").addEventListener("change", () => {
      try {
        applyPriceFilter(produkData);
      } catch (e) {
        showErrorToast("Gagal menerapkan filter harga.");
        console.error("Price filter failed", e);
      }
    });
    // RENDER PRODUCT GRID
    function renderProduk(list) {
      try {
        const grid = document.getElementById("produk-grid");
        if (!grid) {
          showErrorToast("Gagal menampilkan produk.");
          throw new Error("Produk-grid element not found");
        }
        grid.innerHTML = "";
        if (!list || !list.length) {
          grid.innerHTML = `<div class="flex-1 text-center text-gray-500 py-8">Produk tidak ditemukan</div>`;
          return;
        }
        for (const item of list) {
          if (!item || !item.id || !item.nama) {
            showErrorToast("Data produk tidak valid.");
            continue;
          }
          const card = document.createElement("article");
          card.className = "bg-white rounded-xl overflow-hidden shadow hover:shadow-lg transition cursor-pointer";
          const img = document.createElement("img");
          img.src = item.gambar || "";
          img.alt = item.nama || "";
          img.className = "h-40 w-full object-cover";
          const body = document.createElement("div");
          body.className = "p-3";
          const title = document.createElement("h3");
          title.className = "text-sm font-semibold";
          title.innerText = item.nama || "—";
          const merchant = document.createElement("p");
          merchant.className = "text-xs text-gray-500 mt-1";
          merchant.innerText = item.merchant || "";
          const row = document.createElement("div");
          row.className = "mt-3 flex items-center justify-between gap-2";
          const price = document.createElement("div");
          price.className = "text-sm font-bold text-rose-600";
          price.innerText = rupiah(item.harga);
          const btn = document.createElement("button");
          btn.className = "text-xs bg-emerald-600 text-white px-3 py-1 rounded-md hover:bg-emerald-700";
          btn.innerText = "Pesan";
          btn.onclick = (e) => {
            try {
              e.stopPropagation();
              openModal(item);
            } catch (e) {
              showErrorToast("Gagal membuka detail produk.");
              console.error("Open modal failed", e);
            }
          };
          row.appendChild(price);
          row.appendChild(btn);
          body.appendChild(title);
          body.appendChild(merchant);
          body.appendChild(row);
          card.appendChild(img);
          card.appendChild(body);
          card.addEventListener("click", () => {
            try {
              openModal(item);
            } catch (e) {
              showErrorToast("Gagal membuka detail produk.");
              console.error("Open modal failed", e);
            }
          });
          grid.appendChild(card);
        }
      } catch (e) {
        showErrorToast("Gagal menampilkan produk.");
        console.error("renderProduk failed", e);
      }
    }
    // SEARCH
    function performSearch() {
      try {
        const v = document.getElementById("search").value.trim().toLowerCase();
        if (!v) {
          applyPriceFilter(produkData);
          return;
        }
        if (v.length < 2) {
          showErrorToast("Masukkan minimal 2 karakter untuk pencarian.");
          return;
        }
        const filtered = produkData.filter(p =>
          (p.nama || "").toLowerCase().includes(v) ||
          (p.deskripsi || "").toLowerCase().includes(v) ||
          (p.merchant || "").toLowerCase().includes(v) ||
          (p.kategori || "").toLowerCase().includes(v)
        );
        applyPriceFilter(filtered);
      } catch (e) {
        showErrorToast("Gagal melakukan pencarian.");
        console.error("Search failed", e);
      }
    }
    document.getElementById("search").addEventListener("input", performSearch);
    document.getElementById("search-button").addEventListener("click", performSearch);
    // MODAL CONTROLS
    function openModal(item) {
      try {
        if (!item || !item.id || !item.nama) {
          showErrorToast("Data produk tidak valid.");
          return;
        }
        selectedProduk = item;
        selectedQuantity = 1;
        const modal = document.getElementById("modal-produk");
        if (!modal) {
          showErrorToast("Gagal membuka detail produk.");
          throw new Error("Modal-produk element not found");
        }
        document.getElementById("modal-gambar").src = item.gambar || "";
        document.getElementById("modal-nama").innerText = item.nama || "";
        document.getElementById("modal-merchant").innerText = item.merchant || "";
        document.getElementById("modal-deskripsi").innerText = item.deskripsi || "";
        document.getElementById("modal-harga").innerText = rupiah(item.harga);
        document.getElementById("modal-kategori").innerText = item.kategori || "";
        document.getElementById("modal-quantity").innerText = selectedQuantity;
        modal.classList.remove("hidden");
        document.body.classList.add("modal-open");
      } catch (e) {
        showErrorToast("Gagal membuka detail produk.");
        console.error("openModal failed", e);
      }
    }
    function closeModal() {
      try {
        const modal = document.getElementById("modal-produk");
        if (!modal) {
          showErrorToast("Gagal menutup detail produk.");
          throw new Error("Modal-produk element not found");
        }
        modal.classList.add("hidden");
        document.body.classList.remove("modal-open");
      } catch (e) {
        showErrorToast("Gagal menutup detail produk.");
        console.error("closeModal failed", e);
      }
    }
    function openCheckout() {
      try {
        if (!selectedProduk) {
          showErrorToast("Pilih produk terlebih dahulu.");
          return;
        }
        if (selectedQuantity < 1) {
          showErrorToast("Jumlah pesanan minimal 1.");
          return;
        }
        const sum = document.getElementById("checkout-summary");
        if (!sum) {
          showErrorToast("Gagal menampilkan ringkasan pesanan.");
          throw new Error("Checkout-summary element not found");
        }
        sum.innerHTML = `
          <div class="font-semibold">${selectedProduk.nama}</div>
          <div class="text-xs text-gray-500">${selectedProduk.merchant} • ${selectedProduk.alamat || ""}</div>
          <div class="mt-2">Jumlah: ${selectedQuantity}</div>
          <div class="mt-2 text-rose-600 font-bold">Total: ${rupiah(selectedProduk.harga * selectedQuantity)}</div>
        `;
        document.getElementById("input-nama").value = "";
        document.getElementById("input-alamat").value = "";
        document.getElementById("input-hp").value = "";
        closeModal();
        const modalCheckout = document.getElementById("modal-checkout");
        if (!modalCheckout) {
          showErrorToast("Gagal membuka form checkout.");
          throw new Error("Modal-checkout element not found");
        }
        modalCheckout.classList.remove("hidden");
        document.body.classList.add("modal-open");
      } catch (e) {
        showErrorToast("Gagal membuka form checkout.");
        console.error("openCheckout failed", e);
      }
    }
    function closeCheckout() {
      try {
        const modalCheckout = document.getElementById("modal-checkout");
        if (!modalCheckout) {
          showErrorToast("Gagal menutup form checkout.");
          throw new Error("Modal-checkout element not found");
        }
        modalCheckout.classList.add("hidden");
        document.body.classList.remove("modal-open");
      } catch (e) {
        showErrorToast("Gagal menutup form checkout.");
        console.error("closeCheckout failed", e);
      }
    }
    function normalizeHp(raw) {
      try {
        if (!raw) {
          showErrorToast("Nomor HP wajib diisi.");
          return "";
        }
        let s = String(raw).trim().replace(/\s+/g, "");
        s = s.replace(/^(\+62|62)/, "0");
        if (s.startsWith("0")) return "62" + s.slice(1);
        if (s.startsWith("62")) return s;
        return s;
      } catch (e) {
        showErrorToast("Gagal memproses nomor HP.");
        console.error("normalizeHp failed", e);
        return "";
      }
    }
    async function insertOrderToSupabase(orderData) {
      try {
        if (!orderData || !orderData.produk_id || !orderData.nama_pelanggan) {
          showErrorToast("Data pesanan tidak lengkap.");
          throw new Error("Invalid order data");
        }
        const { error } = await supabaseClient
          .from("orders")
          .insert([orderData]);
        if (error) {
          showErrorToast("Gagal menyimpan pesanan ke database. Coba lagi.");
          throw new Error("Error inserting order: " + error.message);
        }
        return true;
      } catch (e) {
        showErrorToast("Gagal menyimpan pesanan ke database.");
        console.error("insertOrderToSupabase failed", e);
        return false;
      }
    }
    async function handleCheckout() {
      try {
        const nama = document.getElementById("input-nama")?.value.trim();
        const alamat = document.getElementById("input-alamat")?.value.trim();
        const hpRaw = document.getElementById("input-hp")?.value.trim();
        if (!nama || !alamat || !hpRaw) {
          showErrorToast("Harap lengkapi semua kolom: Nama, Alamat, dan Nomor HP.");
          return;
        }
        const hp = normalizeHp(hpRaw);
        if (!hp.match(/^(\+62|62|0)\d{9,12}$/)) {
          showErrorToast("Nomor HP tidak valid. Gunakan format 0812xxxx.");
          return;
        }
        if (!selectedProduk) {
          showErrorToast("Produk tidak tersedia. Pilih produk terlebih dahulu.");
          return;
        }
        if (!operatorData.length) {
          showErrorToast("Tidak ada nomor operator. Hubungi admin.");
          return;
        }
        const idx = getWaIndex() % operatorData.length;
        bumpWaIndex();
        const operator = operatorData[idx];
        if (!operator || !operator.nomor) {
          showErrorToast("Nomor operator tidak valid. Hubungi admin.");
          return;
        }
        const totalHarga = selectedProduk.harga * selectedQuantity;
        const orderData = {
          produk_id: selectedProduk.id,
          produk_nama: selectedProduk.nama,
          harga: selectedProduk.harga,
          jumlah: selectedQuantity,
          total: totalHarga,
          nama_pelanggan: nama,
          alamat,
          nomor_hp: hpRaw,
          operator_nomor: operator.nomor,
          created_at: new Date().toISOString()
        };
        const saved = await insertOrderToSupabase(orderData);
        if (!saved) return;
        const list = [
          `Halo Admin, saya ingin pesan:`,
          `Nama: ${nama}`,
          `Alamat: ${alamat}`,
          `HP: ${hpRaw}`,
          `Merchant: ${selectedProduk.merchant || "-"}`,
          `Produk: ${selectedProduk.nama || "-"} (${selectedProduk.kategori || "-"})`,
          `Jumlah: ${selectedQuantity}`,
          `Harga Satuan: ${rupiah(selectedProduk.harga)}`,
          `Total Harga: ${rupiah(totalHarga)}`,
          `---`,
          `*Catatan:*`
        ];
        const text = encodeURIComponent(list.join("\n"));
        const waNumber = String(operator.nomor).replace(/\D/g, "");
        if (!waNumber) {
          showErrorToast("Nomor operator tidak valid.");
          return;
        }
        const url = `https://wa.me/${waNumber}?text=${text}`;
        window.open(url, "_blank");
        try {
          const history = JSON.parse(localStorage.getItem("orders") || "[]");
          history.unshift({
            produkId: selectedProduk.id,
            produkNama: selectedProduk.nama,
            harga: selectedProduk.harga,
            jumlah: selectedQuantity,
            total: totalHarga,
            nama,
            alamat,
            hp: hpRaw,
            operator: waNumber,
            ts: new Date().toISOString()
          });
          localStorage.setItem("orders", JSON.stringify(history.slice(0, 50)));
        } catch (e) {
          showErrorToast("Gagal menyimpan riwayat pesanan lokal.");
          console.error("Local storage save failed", e);
        }
        closeCheckout();
        showToast("Order tersimpan dan mengarahkan ke WhatsApp operator...");
      } catch (e) {
        showErrorToast("Gagal memproses checkout. Coba lagi.");
        console.error("handleCheckout failed", e);
      }
    }
    // HERO ACTION SCROLL
    document.getElementById("hero-action-1")?.addEventListener("click", () => {
      try {
        const grid = document.getElementById("produk-grid");
        if (!grid) {
          showErrorToast("Gagal menavigasi ke daftar produk.");
          throw new Error("Produk-grid element not found");
        }
        grid.scrollIntoView({ behavior: "smooth", block: "start" });
      } catch (e) {
        showErrorToast("Gagal menavigasi ke daftar produk.");
        console.error("Hero action scroll failed", e);
      }
    });
    document.getElementById("hero-action-2")?.addEventListener("click", () => {
      try {
        const grid = document.getElementById("produk-grid");
        if (!grid) {
          showErrorToast("Gagal menavigasi ke daftar produk.");
          throw new Error("Produk-grid element not found");
        }
        grid.scrollIntoView({ behavior: "smooth", block: "start" });
      } catch (e) {
        showErrorToast("Gagal menavigasi ke daftar produk.");
        console.error("Hero action scroll failed", e);
      }
    });
    document.getElementById("hero-action-3")?.addEventListener("click", () => {
      try {
        const grid = document.getElementById("produk-grid");
        if (!grid) {
          showErrorToast("Gagal menavigasi ke daftar produk.");
          throw new Error("Produk-grid element not found");
        }
        grid.scrollIntoView({ behavior: "smooth", block: "start" });
      } catch (e) {
        showErrorToast("Gagal menavigasi ke daftar produk.");
        console.error("Hero action scroll failed", e);
      }
    });
    // ACCESSIBILITY
    document.addEventListener("keydown", (e) => {
      try {
        if (e.key === "Escape") {
          closeModal();
          closeCheckout();
          sidebar.classList.add("translate-x-full");
          backdrop.classList.remove("open");
          document.body.classList.remove("sidebar-open");
        }
      } catch (e) {
        showErrorToast("Gagal menutup modal atau menu.");
        console.error("Escape key handler failed", e);
      }
    });
    // INIT
    try {
      loadData();
    } catch (e) {
      showErrorToast("Gagal memulai aplikasi. Periksa koneksi Anda.");
      console.error("Initialization failed", e);
    }
  </script>
</body>
</html>
